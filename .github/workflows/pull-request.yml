name: Node.js CI

on:
    pull_request:
        branches: [ master ]

jobs:
    test:
        name: Testing
        runs-on: ubuntu-latest

        steps:
        -   uses: actions/checkout@v2
        -   uses: actions/setup-node@v1
            with:
                node-version: 14

        -   name: Install Dependencies
            run: npm install

        -   name: Save Code Linting Report
            run: npm run lint:report
            continue-on-error: true

        -   name: Annotate Code Linting Results
            uses: ataylorme/eslint-annotate-action@1.1.2
            with:
                repo-token: "${{ secrets.GITHUB_TOKEN }}"
                report-json: "eslint_report.json"

        -   name: Upload ESLint report
            uses: actions/upload-artifact@v1
            with:
                name: eslint_report.json
                path: eslint_report.json

        -   name: Annotate Code Test Results
            uses: mattallty/jest-github-action@v1
            env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
